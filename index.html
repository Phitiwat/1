<script>

// hide splash after loaded
setTimeout(()=>document.getElementById("splash")?.remove(),1500);

// load sounds
const correctSound=new Audio("correct.mp3");
const wrongSound=new Audio("wrong.mp3");
const winSound=new Audio("win.mp3");
const loseSound=new Audio("lose.mp3");
const flashSound=new Audio("flashbang.mp3");

function playThenFade(s){
  s.pause();
  s.currentTime=0;
  s.volume=1;
  s.play();
  setTimeout(()=>fadeOut(s),700);
}

function fadeOut(s){
  let vol=s.volume;
  let f=setInterval(()=>{
    vol-=0.1;
    if(vol<=0){
      s.pause();
      clearInterval(f);
    } else s.volume=vol;
  },60);
}

const notes=["ð…","ð…ž","â™©","â™ª","ð„»","ð„¼","ð„½","ð„¾"];
const modes={easy:3,normal:4,hard:6,extreme:8};

let life=6,level=1,first=null,lock=true,match=0;

function vibrate(){navigator.vibrate?.(200);}

function showOverlay(img,victory=false){
  const ov=document.getElementById("overlay");
  const imgEl=document.getElementById("overlayImg");
  if(!ov||!imgEl)return;
  imgEl.src=img;
  ov.classList.add("show");
  ov.style.display="flex";

  if(victory){
    document.getElementById("flash").style.opacity=1;
    flashSound.play();
    setTimeout(()=>document.getElementById("flash").style.opacity=0,300);
  }

  setTimeout(()=>{
    ov.classList.remove("show");
    ov.style.display="none";
  },1500);
}

function startGame(){
  life=6;
  level=1;
  build();
}

function build(){
  lock=true;
  correctSound.pause(); wrongSound.pause(); winSound.pause(); loseSound.pause();

  const g=document.getElementById("game");
  if(!g)return;
  g.innerHTML="";

  document.getElementById("life").innerText=life;
  document.getElementById("level").innerText=level;

  first=null;
  match=0;

  let p=modes[document.getElementById("mode")?.value||"easy"];
  let arr=[];
  for(let i=0;i<p;i++)arr.push(notes[i],notes[i]);
  arr.sort(()=>Math.random()-0.5);

  arr.forEach(n=>{
    const card=document.createElement("div");
    card.className="card";

    card.onclick=()=>{
      if(lock||card.classList.contains("open"))return;
      card.classList.add("open");
      card.innerText=n;

      if(!first){
        first=card;
        return;
      }

      lock=true;
      if(first.innerText===n){
        playThenFade(correctSound);
        match++;
        first=null;
        setTimeout(()=>{
          if(match===p){
            if(document.getElementById("mode")?.value==="extreme"){
              playThenFade(winSound);
              showOverlay("victory.png",true);
            } else {
              level++;
              playThenFade(winSound);
              build();
            }
          } else lock=false;
        },1400);

      } else {
        playThenFade(wrongSound);
        showOverlay("wrong.png");
        vibrate();
        life--;
        document.getElementById("life").innerText=life;

        setTimeout(()=>{
          first.classList.remove("open");
          card.classList.remove("open");
          first=null;

          if(life<=0){
            playThenFade(loseSound);
            showOverlay("lose.png");
          } else lock=false;
        },1400);
      }
    };

    g.appendChild(card);
  });

  setTimeout(()=>lock=false,400);
}

document.getElementById("mode")?.addEventListener("change",startGame);

startGame();

 </script>
